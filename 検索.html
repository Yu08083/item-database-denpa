<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>アイテム検索ツール</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    h2 {
      text-align: center;
    }
    .search-bar {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }
    input {
      font-size: 16px;
      padding: 8px;
      width: 300px;
      max-width: 90%;
    }
    button {
      font-size: 16px;
      padding: 8px 16px;
      background: #4CAF50;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
    button:hover {
      background: #45a049;
    }
    .results {
      max-height: 500px;
      overflow-y: auto;
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 10px;
    }

    /* PC版: テーブル表示 */
    .pc-view table {
      width: 100%;
      border-collapse: collapse;
    }
    .pc-view thead {
      position: sticky;
      top: 0;
      background: #f4f4f4;
    }
    .pc-view th, .pc-view td {
      padding: 8px;
      border-bottom: 1px solid #ddd;
      text-align: left;
      font-family: monospace;
    }
    .pc-view tr:hover {
      background-color: #f9f9f9;
    }

    /* スマホ版: 縦カード表示 */
    .mobile-view .item-card {
      border-bottom: 1px solid #ddd;
      padding: 10px 0;
      font-family: monospace;
    }
    .mobile-view .item-card:last-child {
      border-bottom: none;
    }

    .no-results {
      text-align: center;
      color: #888;
      padding: 20px;
    }

    /* スマホ切り替え */
    @media (max-width: 768px) {
      .pc-view { display: none; }
      .mobile-view { display: block; }
    }
    @media (min-width: 769px) {
      .pc-view { display: block; }
      .mobile-view { display: none; }
    }
  </style>
</head>
<body>
  <h2>アイテム検索ツール</h2>
  <div class="search-bar">
    <input id="query" type="text" placeholder="例: ジュエルのかけら">
    <button onclick="searchItems()">検索</button>
  </div>

  <!-- PC表示 -->
  <div class="results pc-view">
    <table id="results-pc">
      <thead>
        <tr>
          <th>HexID</th>
          <th>ShortID</th>
          <th>Name</th>
          <th>SignedInt</th>
        </tr>
      </thead>
      <tbody>
        <tr><td colspan="4" class="no-results">🔍 検索ワードを入力してください</td></tr>
      </tbody>
    </table>
  </div>

  <!-- スマホ表示 -->
  <div class="results mobile-view" id="results-mobile">
    <div class="no-results">🔍 検索ワードを入力してください</div>
  </div>

  <script>
    let data = [];

    // GitHubからデータ取得
    fetch("https://raw.githubusercontent.com/Yu08083/item-database-denpa/main/itemlist_with_shortid.txt")
      .then(res => res.text())
      .then(text => {
        data = text.trim().split("\n").map(line => {
          let parts = line.split("_");
          if (parts.length === 5) {
            return {
              HexID: parts[1].toUpperCase(),
              ShortID: parts[2].toLowerCase(),
              Name: parts[3],
              SignedInt: parseInt(parts[4])
            };
          }
          return null;
        }).filter(Boolean);
      });

    // 入力正規化（全角数字→半角、カンマ削除）
    function normalizeQuery(q) {
      q = q.replace(/[０-９]/g, d => String.fromCharCode(d.charCodeAt(0) - 65248));
      q = q.replace(/,/g, "");
      return q.trim().toLowerCase();
    }

    function searchItems() {
      let rawQ = document.getElementById("query").value;
      let q = normalizeQuery(rawQ);
      let pcTbody = document.querySelector("#results-pc tbody");
      let mobileDiv = document.getElementById("results-mobile");

      if (!q) {
        pcTbody.innerHTML = `<tr><td colspan="4" class="no-results">🔍 検索ワードを入力してください</td></tr>`;
        mobileDiv.innerHTML = `<div class="no-results">🔍 検索ワードを入力してください</div>`;
        return;
      }

      let results = [];
      if (/^-?\d+$/.test(q)) {
        // 数値検索
        results = data.filter(d => d.SignedInt == q);
      } else if (/^[0-9a-f-]+$/.test(q)) {
        // HexID / ShortID
        results = data.filter(d =>
          d.HexID.toLowerCase() === q ||
          d.ShortID.toLowerCase() === q
        );
      } else {
        // 名前検索
        results = data.filter(d => d.Name.toLowerCase().includes(q));
      }

      if (results.length === 0) {
        pcTbody.innerHTML = `<tr><td colspan="4" class="no-results">❌ 該当するアイテムが見つかりませんでした</td></tr>`;
        mobileDiv.innerHTML = `<div class="no-results">❌ 該当するアイテムが見つかりませんでした</div>`;
      } else {
        // PC表示
        pcTbody.innerHTML = results.map(r => `
          <tr>
            <td>${r.HexID}</td>
            <td>${r.ShortID}</td>
            <td>${r.Name}</td>
            <td>${r.SignedInt}</td>
          </tr>
        `).join("");

        // スマホ表示
        mobileDiv.innerHTML = results.map(r => `
          <div class="item-card">
            HexID    : ${r.HexID}<br>
            ShortID  : ${r.ShortID}<br>
            Name     : ${r.Name}<br>
            SignedInt: ${r.SignedInt}
          </div>
        `).join("");
      }
    }

    // Enterキーでも検索実行
    document.getElementById("query").addEventListener("keypress", e => {
      if (e.key === "Enter") searchItems();
    });
  </script>
</body>
</html>


